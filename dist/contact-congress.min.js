/*
 *  Contact Congress - v0.0.1
 *  A widget for building forms for contacting congress.
 *  https://github.com/efforg/contact-congress.js
 *
 *  Made by Thomas Davis
 *  Under TBD License
 */
!function(a){function b(b,e){this.element=b,this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}var c="contactCongress",d={contactCongressServer:"http://ec2-54-215-28-56.us-west-1.compute.amazonaws.com:3000",labels:!0,bioguide_ids:[],labelClasses:"",textInputClasses:"form-control",formClasses:"form",selectInputClasses:"form-control",formGroupClasses:"form-group",submitClasses:"btn"};b.prototype={init:function(){var b=a("<form/>").addClass(this.settings.formClasses);this.retrieveFormElements(b)},retrieveFormElements:function(b){var c=this;a.ajax({url:c.settings.contactCongressServer+"/retrieve-form-elements",type:"post",data:{bio_ids:this.settings.bioguide_ids},success:function(a){var d=c.groupCommonFields(a);c.generateForm(d,b)}})},generateForm:function(b,c){var d=this,e=b.common_fields,f=a("<fieldset/>");a.each(e,function(a,b){var c=d.generateFormGroup(b);f.append(c)}),c.append(f),a.each(b.individual_fields,function(b,e){var f=a("<fieldset/>");a.each(e,function(a,b){var c=d.generateFormGroup(b);f.append(c)}),c.append(f)});var g=a('<input type="submit"/>');g.addClass(d.settings.submitClasses),c.append(g),a(d.element).append(c)},generateFormGroup:function(b){var c=this,d=c._format_label(b.value),e=b.value,f=a("<div/>").addClass(this.settings.formGroupClasses);if(c.settings.labels){var g=a("<label/>").text(d).attr("for",e).addClass(this.settings.labelClasses);f.append(g)}if(null!==b.options_hash||"$ADDRESS_STATE_POSTAL_ABBREV"===b.value||"$ADDRESS_STATE"===b.value){var h=a("<select/>");if(h.addClass(c.settings.selectInputClasses),b.options=[],("$ADDRESS_STATE_POSTAL_ABBREV"===b.value||"$ADDRESS_STATE"===b.value)&&(b.options=c._data.STATES,delete b.options_hash),b.options_hash&&a.isArray(b.options_hash)&&"object"==typeof b.options_hash[0]){var i={};a.each(b.options_hash,function(b){a.each(b,function(a,b){i[b]=a})}),b.options_hash=i}b.options_hash&&!a.isArray(b.options_hash)&&(a.each(b.options_hash,function(a,c){b.options.push({name:a,value:c})}),delete b.options_hash),console.log(typeof b.options_hash),"string"!=typeof b.options_hash&&b.options_hash||(b.options_hash=[]),a.each(b.options_hash,function(b,c){var d=a("<option/>").attr("value",c).text(c);h.append(d)}),a.each(b.options,function(b,c){console.log(c);var d=a("<option/>").attr("value",c.value).text(c.name);h.append(d)})}else{var h=a('<input type="text" />').attr("placeholder",d);h.addClass(c.settings.textInputClasses)}return f.append(h),f},groupCommonFields:function(b){var c=this,d={common_fields:[],individual_fields:{}},e=c.settings.bioguide_ids.length;if(e>1){var f={};a.each(this.settings.bioguide_ids,function(c,e){var g=b[e];a.each(g.required_actions,function(a,b){null===b.options_hash?"undefined"==typeof f[b.value]?f[b.value]=[e]:f[b.value].push(e):"undefined"==typeof d.individual_fields[e]?d.individual_fields[e]=[b]:d.individual_fields[e].push(b)})});a.each(f,function(b,c){c.length>1?d.common_fields.push({value:b,options_hash:null}):a.each(c,function(a,c){"undefined"==typeof d.individual_fields[c]?d.individual_fields[c]=[{value:b,options_hash:null}]:d.individual_fields[c].push({value:b,options_hash:null})})})}else d.common_fields=b[c.settings.bioguide_ids[0]].required_actions;return console.log(d),d},_format_label:function(b){var c=b.replace("$","").replace("_"," ").split(" ");return a.map(c,function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()}).join(" ")},_data:{STATES:[{name:"ALABAMA",value:"AL"},{name:"ALASKA",value:"AK"},{name:"AMERICAN SAMOA",value:"AS"},{name:"ARIZONA",value:"AZ"},{name:"ARKANSAS",value:"AR"},{name:"CALIFORNIA",value:"CA"},{name:"COLORADO",value:"CO"},{name:"CONNECTICUT",value:"CT"},{name:"DELAWARE",value:"DE"},{name:"DISTRICT OF COLUMBIA",value:"DC"},{name:"FEDERATED STATES OF MICRONESIA",value:"FM"},{name:"FLORIDA",value:"FL"},{name:"GEORGIA",value:"GA"},{name:"GUAM",value:"GU"},{name:"HAWAII",value:"HI"},{name:"IDAHO",value:"ID"},{name:"ILLINOIS",value:"IL"},{name:"INDIANA",value:"IN"},{name:"IOWA",value:"IA"},{name:"KANSAS",value:"KS"},{name:"KENTUCKY",value:"KY"},{name:"LOUISIANA",value:"LA"},{name:"MAINE",value:"ME"},{name:"MARSHALL ISLANDS",value:"MH"},{name:"MARYLAND",value:"MD"},{name:"MASSACHUSETTS",value:"MA"},{name:"MICHIGAN",value:"MI"},{name:"MINNESOTA",value:"MN"},{name:"MISSISSIPPI",value:"MS"},{name:"MISSOURI",value:"MO"},{name:"MONTANA",value:"MT"},{name:"NEBRASKA",value:"NE"},{name:"NEVADA",value:"NV"},{name:"NEW HAMPSHIRE",value:"NH"},{name:"NEW JERSEY",value:"NJ"},{name:"NEW MEXICO",value:"NM"},{name:"NEW YORK",value:"NY"},{name:"NORTH CAROLINA",value:"NC"},{name:"NORTH DAKOTA",value:"ND"},{name:"NORTHERN MARIANA ISLANDS",value:"MP"},{name:"OHIO",value:"OH"},{name:"OKLAHOMA",value:"OK"},{name:"OREGON",value:"OR"},{name:"PALAU",value:"PW"},{name:"PENNSYLVANIA",value:"PA"},{name:"PUERTO RICO",value:"PR"},{name:"RHODE ISLAND",value:"RI"},{name:"SOUTH CAROLINA",value:"SC"},{name:"SOUTH DAKOTA",value:"SD"},{name:"TENNESSEE",value:"TN"},{name:"TEXAS",value:"TX"},{name:"UTAH",value:"UT"},{name:"VERMONT",value:"VT"},{name:"VIRGIN ISLANDS",value:"VI"},{name:"VIRGINIA",value:"VA"},{name:"WASHINGTON",value:"WA"},{name:"WEST VIRGINIA",value:"WV"},{name:"WISCONSIN",value:"WI"},{name:"WYOMING",value:"WY"}]}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))}),this}}(jQuery,window,document);